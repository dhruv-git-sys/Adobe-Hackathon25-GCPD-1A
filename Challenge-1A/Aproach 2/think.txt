COMPREHENSIVE ANALYSIS & ALGORITHM DESIGN PLAN
==============================================

üìã THE 5 SACRED RULES FROM README.md:
=====================================
Rule #1: No Hardcoded Font Sizes üö´ (use percentiles only)
Rule #2: No Hardcoded Keywords üö´ (formatting features only)  
Rule #3: No Fixed Thresholds üö´ (adaptive thresholds)
Rule #4: Adaptive Statistical Analysis Only üìä (percentiles, z-scores, ratios)
Rule #5: Truly Generic Processing üåç (works on all PDF types)

üîç CRITICAL ANALYSIS OF TRAINING DATA MISTAKES:
===============================================

FILE01 (Government Form):
------------------------
EXPECTED: title="Application form for grant of LTC advance", outline=[]
ACTUAL: title="Application form for grant of LTC advance", outline=[12 H3 headings with "1.", "2.", etc.]
MISTAKE: Form detection failed! Numbering (1., 2., 3...) are FIELD LABELS, NOT HEADINGS
INSIGHT: Need stronger form detection - when numbers are field labels, NO outline expected

FILE02 (Technical Manual):
--------------------------  
EXPECTED: 17 H1 headings + many H2 headings (hierarchical structure)
ACTUAL: Only 6 H3 headings, missing hierarchy completely
MISTAKE: Failed to detect hierarchical patterns, missed numbered sections (1., 2.1, 2.2)
INSIGHT: Need section numbering detection + proper H1/H2/H3 classification

FILE03 (Business Proposal):
---------------------------
EXPECTED: Complex hierarchy with H1/H2/H3 levels, 50+ headings
ACTUAL: title corrupted ("RFP: R RFP: R..."), outline=[]
MISTAKE: Title extraction broken + failed to find any headings
INSIGHT: Title corruption suggests PDF parsing issue, need robust title detection

FILE04 (STEM Document):
----------------------
EXPECTED: title="Parsippany -Troy Hills STEM Pathways", outline=[1 H1: "PATHWAY OPTIONS"]
ACTUAL: title correct, outline=[]
MISTAKE: Failed to detect "PATHWAY OPTIONS" as heading despite being important
INSIGHT: All-caps text might need special handling

FILE05 (Event Flyer):
--------------------
EXPECTED: title="", outline=[1 H1: "HOPE To SEE You THERE!"]
ACTUAL: title="----------------", outline=[3 H3: "HOPE", "SEE", "HERE"]
MISTAKE: Wrong title extraction + split single phrase into separate words
INSIGHT: Decorative elements ("----") shouldn't be titles, phrase splitting error

üìä STATISTICAL INSIGHTS FROM SEGMENTED DATA:
============================================

FILE01 (Form): 
- Size pattern: Title=11.67, Fields=9.74 (consistent sizes)
- Bold pattern: Numbers bold, descriptions normal
- Structure: Numbered list format (1., 2., 3...)

FILE02 (Manual):
- Size pattern: Title=24.0, Large=18.0, Medium=12.0, Small=9.96  
- Clear hierarchy in font sizes
- Sections have numbers (1., 2.1, etc.)

FILE05 (Flyer):
- Alpha=0 (transparent text - special case!)
- Mixed fonts: Helvetica, Helvetica-Bold
- Decorative elements present

üéØ ALGORITHM DESIGN STRATEGY:
============================

PHASE 1: DOCUMENT TYPE CLASSIFICATION
-------------------------------------
1. FORM DETECTION:
   - Uniform font sizes (std < 3.0)
   - Numbered field patterns (1., 2., 3... with descriptions)
   - High ratio of colon usage (:)
   - Form keywords in early segments
   ‚Üí IF FORM DETECTED: outline = []

2. HIERARCHICAL DOCUMENT DETECTION:
   - Large font size variation (std > 5.0)  
   - Section numbering patterns (1., 2.1, 2.2, etc.)
   - Clear size-based hierarchy
   ‚Üí IF HIERARCHICAL: Apply hierarchy classification

3. FLYER/POSTER DETECTION:
   - Mixed formatting, decorative elements
   - Short text segments
   - Visual emphasis patterns
   ‚Üí IF FLYER: Special handling for emphasis

PHASE 2: TITLE EXTRACTION (Rule-Compliant)
------------------------------------------
PRIORITY ORDER:
1. Largest font on first page (size percentile > 95%)
2. If corrupted text ‚Üí Use second largest
3. If decorative elements ‚Üí Skip patterns like "----", "===", etc.
4. If transparent (alpha=0) ‚Üí Skip unless only option

PHASE 3: OUTLINE EXTRACTION ALGORITHM  
------------------------------------
MEGA STATISTICAL HYBRID APPROACH:

A) FEATURE EXTRACTION (Using ALL 12 segment attributes):
   - size_percentile = rank(size) / total_segments
   - flags_score = bold(16) + italic(2) bonuses  
   - font_analysis = detect bold/heavy in font name
   - color_uniqueness = different from document mode
   - alpha_transparency = handle alpha=0 cases
   - position_bonus = early_page + early_document bonuses
   - text_pattern_analysis = numbering, case, punctuation
   
B) DOCUMENT-ADAPTIVE SCORING:
   - Base score = size_percentile * 30
   - Format bonuses: +20 bold, +15 italic, +10 unique_color
   - Pattern bonuses: +25 section_numbers, +15 title_case
   - Position bonuses: +10 early_doc, +5 early_page
   - Link bonus: +30 hyperlinks
   
   PENALTIES:
   - Length penalty: -20 if len>100, -30 if len>200
   - Sentence penalty: -15 ends with period/comma
   - Paragraph indicators: -10 common words with high word_count

C) ADAPTIVE THRESHOLD CALCULATION:
   threshold = score_mean + (complexity_factor * score_std)
   where complexity_factor = 0.3 (forms) to 0.8 (manuals)

D) HIERARCHY CLASSIFICATION (Statistical Only):
   H1: size_percentile > 0.9 AND score > (mean + 1.5*std)
   H2: size_percentile > 0.7 AND score > (mean + 1.0*std)  
   H3: score > threshold

E) SPECIAL PATTERN HANDLING:
   - Section numbering: "1.", "2.1", "A.1" ‚Üí Hierarchy hints
   - All caps: Bonus for potential headings
   - Colon endings: Context-dependent (forms vs sections)

PHASE 4: POST-PROCESSING
-----------------------
1. DUPLICATE REMOVAL: Hash-based deduplication
2. PHRASE RECONSTRUCTION: Avoid word splitting (FILE05 fix)
3. HIERARCHY VALIDATION: Ensure logical H1‚ÜíH2‚ÜíH3 flow
4. POSITION SORTING: By page, then by segment position

üîß IMPLEMENTATION PRIORITIES:
============================
1. Fix form detection (FILE01) - CRITICAL
2. Implement proper hierarchy (FILE02) - HIGH  
3. Robust title extraction (FILE03) - HIGH
4. All-caps handling (FILE04) - MEDIUM
5. Phrase preservation (FILE05) - MEDIUM

üí° KEY INNOVATIONS:
==================
- Document type classification BEFORE outline extraction
- Statistical complexity factor for adaptive thresholds
- Transparent text (alpha=0) special handling
- Section numbering pattern recognition
- Phrase reconstruction to prevent word splitting
- Form vs heading number disambiguation

üéØ SUCCESS METRICS TARGET:
=========================
- FILE01: FORM ‚Üí outline=[] ‚úÖ
- FILE02: HIERARCHY ‚Üí 17 H1s + H2s with proper levels ‚úÖ  
- FILE03: ROBUST TITLE + complex outline ‚úÖ
- FILE04: "PATHWAY OPTIONS" as H1 ‚úÖ
- FILE05: "HOPE To SEE You THERE!" as single H1 ‚úÖ

This algorithm will be POWERFUL, ACCURATE, and 100% RULE-COMPLIANT! üöÄ
